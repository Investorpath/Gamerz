# قائمة فحص الأمان (Security Checklist)

تهدف هذه القائمة إلى مساعدة المطورين على مراجعة وتأكيد تطبيق معايير الأمان قبل إطلاق تطبيق الألعاب الجماعية. يرجى التحقق من كل بند:

## 1. المصادقة والتحكم في الوصول (Authentication & Authorization)
- [ ] **حماية مسارات API (API Routes):** التأكد من أن جميع المسارات الحساسة (مثل `/api/auth/me` أو أي مسار لتعديل البيانات) محمية بواسطة الوسيط `isAuthenticated`.
- [ ] **تأمين اتصال Socket.io:** التحقق من تمرير `token` في الـ Handshake الخاص بـ Socket.io، وأن الاتصال يُرفض فوراً في حال عدم وجود الرمز أو عدم صلاحيته.
- [ ] **نطاق الغرف (Room Scoping):** التحقق من منع أي مستخدم من إرسال أو استقبال أحداث (Events) خاصة بغرفة غير منضم إليها فعلياً (تَم حلها عبر التحقق من `socket.rooms`).

## 2. تقييد الطلبات (Rate Limiting)
- [ ] **واجهة برمجة التطبيقات (Express API):** تفعيل تقييد الطلبات على مسارات تسجيل الدخول والتسجيل لمنع هجمات التخمين (Brute-Force).
- [ ] **أحداث Socket.io:** التأكد من وجود آلية لمنع "السبام" أو إرسال أحداث سريعة جداً (مثل الضغط المتكرر على زر الإجابة) مما قد يؤدي لإرهاق الخادم (تم تحديد 5 أحداث كحد أقصى لكل ثانية لكل مستخدم).

## 3. حماية المدخلات وتنقية المحتوى (Input Validation)
- [ ] **منع هجمات XSS:** التحقق من تعقيم كافة مدخلات النصوص باستخدام التابع `sanitizeInput` قبل تخزينها أو بثها للمستخدمين الآخرين.
- [ ] **فلتر الكلمات البذيئة (Profanity Filter):** التأكد من تنقية أسماء اللاعبين وأي رسائل في الدردشة من الكلمات غير اللائقة أو استبدالها بـ `***`.

## 4. أمن قاعدة البيانات (Database Security)
- [ ] **تفادي IDOR (Insecure Direct Object Reference):** التأكد من أن التحديثات داخل اللعبة (مثل الأهداف، الأدوار، وغيرها) تعتمد بالأساس على تتبع الخادم (Server-side tracking) من خلال معرف الاتصال `socket.id` بدلاً من الاعتماد الأعمى على المعرفات المُرسلة من العميل.
- [ ] **إدارة دورة حياة الغرفة:** تفعيل عملية تنظيف قاعدة البيانات (Cleanup Job) لحذف أو إنهاء الغرف التي لم تنشط منذ أكثر من 24 ساعة لتقليل استهلاك موارد الخادم.

## 5. إعدادات بيئة الإنتاج (Production Environment)
- [ ] **إعدادات CORS:** تخصيص إعدادات CORS لتسمح فقط بالنطاقات الموثوقة (Domains) الخاصة بالعميل (Frontend).
- [ ] **إدارة المتغيرات البيئية:** التأكد من تغيير `JWT_SECRET` ليكون قوياً ومخزناً بشكل آمن في ملف `.env`، وعدم الكشف عنه في الشيفرة.
- [ ] **الاتصال الآمن:** تأكيد تشغيل الخادم والعميل على HTTPS و WSS لضمان تشفير البيانات أثناء النقل.
